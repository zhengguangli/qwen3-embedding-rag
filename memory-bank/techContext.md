# 技术上下文 (Technical Context)

## 核心技术栈

### 1. 嵌入模型
- **Qwen3-Embedding**: 阿里云通义千问3嵌入模型
- **模型特点**: 多语言支持、高质量语义表示
- **集成方式**: 通过Hugging Face Transformers库

### 2. 向量数据库
- **Milvus**: 开源向量数据库
- **版本**: 2.4.x
- **特性**: 高性能、可扩展、支持多种索引类型
- **部署**: Docker容器化部署

### 3. 大语言模型
- **支持提供商**: OpenAI、本地模型
- **API集成**: 异步调用、流式输出
- **提示工程**: 结构化提示模板

### 4. 重排序算法
- **BM25**: 传统文本相似度算法
- **语义重排序**: 基于嵌入向量的重排序
- **混合重排序**: 多算法组合优化

## 开发环境

### 1. Python环境
- **Python版本**: 3.8+
- **包管理**: Poetry (pyproject.toml)
- **虚拟环境**: 自动管理

### 2. 开发工具
- **代码质量**: 
  - flake8 (代码风格检查)
  - black (代码格式化)
  - isort (导入排序)
  - mypy (类型检查)
- **预提交钩子**: pre-commit
- **测试框架**: pytest
- **CLI框架**: Click + Rich

### 3. 配置管理
- **配置格式**: YAML、JSON、环境变量
- **验证**: Pydantic模型
- **热重载**: 配置变更自动检测

### 4. 入口点管理
- **主入口点**: main.py
- **CLI框架**: Click + Rich
- **错误处理**: 导入验证和用户友好提示
- **模块导入**: 清晰的路径管理

## 依赖管理

### 核心依赖
```toml
[tool.poetry.dependencies]
python = "^3.8"
click = "^8.1.0"
rich = "^13.0.0"
pydantic = "^2.0.0"
pymilvus = "^2.3.0"
transformers = "^4.30.0"
torch = "^2.0.0"
openai = "^1.0.0"
aiohttp = "^3.8.0"
asyncio = "^3.4.3"
```

### 开发依赖
```toml
[tool.poetry.group.dev.dependencies]
pytest = "^7.0.0"
pytest-asyncio = "^0.21.0"
flake8 = "^6.0.0"
black = "^23.0.0"
isort = "^5.12.0"
mypy = "^1.0.0"
pre-commit = "^3.0.0"
```

## 部署环境

### 1. 本地开发
- **Docker Compose**: Milvus服务容器化
- **环境变量**: 本地配置文件
- **日志**: 本地文件输出

### 2. 生产环境
- **容器化**: Docker镜像
- **编排**: Kubernetes部署
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack

## 性能要求

### 1. 响应时间
- **检索时间**: < 500ms
- **生成时间**: < 2s
- **总响应时间**: < 3s

### 2. 吞吐量
- **并发查询**: 100+ QPS
- **文档处理**: 1000+ 文档/分钟
- **向量存储**: 100万+ 向量

### 3. 资源使用
- **内存**: < 8GB
- **CPU**: 4+ 核心
- **存储**: SSD推荐

## 安全考虑

### 1. 数据安全
- **向量加密**: 敏感数据加密存储
- **访问控制**: 基于角色的权限管理
- **审计日志**: 操作记录和追踪

### 2. API安全
- **认证**: API密钥或OAuth2
- **限流**: 请求频率限制
- **输入验证**: 严格的输入检查

## 监控和日志

### 1. 性能监控
- **指标收集**: 响应时间、吞吐量、错误率
- **告警**: 阈值告警和异常检测
- **可视化**: 实时仪表板

### 2. 日志管理
- **结构化日志**: JSON格式
- **日志级别**: DEBUG、INFO、WARNING、ERROR
- **日志轮转**: 自动归档和清理

## 测试策略

### 1. 单元测试
- **覆盖率**: > 80%
- **框架**: pytest
- **模拟**: Mock外部依赖

### 2. 集成测试
- **端到端测试**: 完整流程验证
- **性能测试**: 负载和压力测试
- **兼容性测试**: 不同环境验证

### 3. 入口点测试
- **CLI命令测试**: 所有命令功能验证
- **导入测试**: 模块导入稳定性
- **错误处理测试**: 异常情况处理

## 代码质量

### 1. 静态分析
- **类型检查**: mypy 100%通过
- **代码风格**: flake8 100%符合规范
- **格式化**: black + isort 自动格式化

### 2. 预提交检查
- **自动化**: pre-commit钩子
- **检查项目**: 类型、风格、格式化、测试
- **强制执行**: 提交前必须通过所有检查

### 3. 持续集成
- **自动化测试**: 每次提交自动运行测试
- **质量门禁**: 覆盖率、类型检查、风格检查
- **部署准备**: 生产环境部署前验证 