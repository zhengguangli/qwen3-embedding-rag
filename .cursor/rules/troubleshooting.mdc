---
description: 
globs: 
alwaysApply: false
---
# RAG 系统故障排除指南

## 常见问题及解决方案

### 1. Milvus 连接问题

#### 问题：连接失败
```
错误信息：Connection refused 或 Timeout
```

**解决方案：**
- 检查 Milvus 服务是否启动
- 验证连接地址：[config.json](mdc:config.json) 中的 `milvus_uri`
- 确认网络连接和防火墙设置
- 查看 Milvus 服务日志

#### 问题：维度不匹配
```
错误信息：Dimension mismatch 或 ParamError
```

**解决方案：**
- 检查 [rag/config.py](mdc:rag/config.py) 中的 `embedding_dim` 设置
- 确认模型的实际输出维度
- 使用 `--force-recreate` 参数重建集合

### 2. 模型加载问题

#### 问题：Ollama 模型未找到
```
错误信息：Model not found 或 404 Not Found
```

**解决方案：**
- 确认 Ollama 服务正在运行
- 检查模型名称是否正确
- 运行 `ollama list` 查看可用模型
- 使用 `ollama pull` 下载所需模型

#### 问题：API 调用失败
```
错误信息：HTTP 错误或连接超时
```

**解决方案：**
- 检查 Ollama 服务地址和端口
- 确认网络连接正常
- 查看 [rag/utils.py](mdc:rag/utils.py) 中的日志配置
- 尝试直接调用 API 测试连接

### 3. 文档处理问题

#### 问题：文档加载失败
```
错误信息：File not found 或 Permission denied
```

**解决方案：**
- 检查文档路径配置：[config.json](mdc:config.json) 中的 `data_path`
- 确认文件存在且有读取权限
- 验证文件格式是否正确（Markdown）
- 查看 [rag/document.py](mdc:rag/document.py) 中的错误处理

#### 问题：分块处理异常
```
错误信息：Memory error 或 Processing failed
```

**解决方案：**
- 减少批处理大小：[rag/config.py](mdc:rag/config.py) 中的 `batch_size`
- 调整分块大小：`chunk_size` 和 `chunk_overlap`
- 检查可用内存
- 使用更小的文档进行测试

### 4. 性能问题

#### 问题：处理速度慢
**解决方案：**
- 增加并发数：[rag/config.py](mdc:rag/config.py) 中的 `max_workers`
- 启用缓存机制
- 优化批处理大小
- 检查网络延迟

#### 问题：内存使用过高
**解决方案：**
- 减少批处理大小
- 降低并发数
- 定期清理缓存
- 使用流式处理

### 5. 输出问题

#### 问题：答案文件未生成
**解决方案：**
- 检查 `answers/` 目录是否存在
- 确认文件写入权限
- 查看 [rag/main.py](mdc:rag/main.py) 中的文件保存逻辑
- 检查磁盘空间

#### 问题：日志文件过大
**解决方案：**
- 调整日志级别：[rag/utils.py](mdc:rag/utils.py)
- 定期清理日志文件
- 使用日志轮转
- 只保留必要的日志信息

## 调试技巧

### 1. 日志分析
```bash
# 查看最新日志
tail -f logs/rag_system.log

# 查看错误日志
grep ERROR logs/rag_system.log

# 查看特定组件的日志
grep "rag.pipeline" logs/rag_system.log
```

### 2. 配置验证
```python
# 在 [rag/main.py](mdc:rag/main.py) 中添加配置验证
config.print_config()  # 打印所有配置项
```

### 3. 组件测试
```python
# 单独测试各个组件
from rag.config import RAGConfig
from rag.embedding import EmbeddingService

config = RAGConfig()
embedding_service = EmbeddingService(config, client)
result = embedding_service.encode("test text")
print(f"Embedding dimension: {len(result)}")
```

### 4. 性能监控
```python
# 添加性能监控代码
import time

start_time = time.time()
# 执行操作
elapsed_time = time.time() - start_time
logger.info(f"Operation took {elapsed_time:.2f} seconds")
```

## 环境检查清单

### 1. 系统要求
- [ ] Python 3.8+ 已安装
- [ ] 虚拟环境已激活
- [ ] 依赖包已安装：[requirements.txt](mdc:requirements.txt)

### 2. 服务状态
- [ ] Ollama 服务正在运行
- [ ] Milvus 服务正在运行
- [ ] 网络连接正常

### 3. 配置检查
- [ ] [config.json](mdc:config.json) 配置正确
- [ ] API 地址和端口正确
- [ ] 模型名称正确
- [ ] 文档路径存在

### 4. 权限检查
- [ ] 文件读取权限
- [ ] 目录写入权限
- [ ] 网络访问权限

## 获取帮助

### 1. 日志文件位置
- 系统日志：`logs/rag_system.log`
- 答案文件：`answers/` 目录

### 2. 配置文件
- 主配置：[config.json](mdc:config.json)
- 项目配置：[pyproject.toml](mdc:pyproject.toml)

### 3. 文档资源
- 项目说明：[README.md](mdc:README.md)
- 代码注释和文档字符串
- 官方文档和社区资源
